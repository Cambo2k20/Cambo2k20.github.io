<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia Hero</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .pulse-animation { animation: pulse 1s ease-in-out infinite; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .shake { animation: shake 0.3s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Fisher-Yates shuffle algorithm
        const shuffle = (array) => {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        };

        // Levenshtein distance for fuzzy matching
        const levenshtein = (a, b) => {
            const matrix = [];
            const aLower = a.toLowerCase().trim();
            const bLower = b.toLowerCase().trim();
            
            for (let i = 0; i <= bLower.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= aLower.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= bLower.length; i++) {
                for (let j = 1; j <= aLower.length; j++) {
                    if (bLower[i - 1] === aLower[j - 1]) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[bLower.length][aLower.length];
        };

        const similarity = (a, b) => {
            const maxLen = Math.max(a.length, b.length);
            if (maxLen === 0) return 1;
            return (maxLen - levenshtein(a, b)) / maxLen;
        };

        // SVG Icons
        const TrophyIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M5 3h14v3a5 5 0 01-5 5h-4a5 5 0 01-5-5V3zm2 0v3a3 3 0 003 3h4a3 3 0 003-3V3H7zM4 3a1 1 0 00-1 1v2a4 4 0 003 3.87V11a1 1 0 001 1h2v2H7a1 1 0 00-1 1v2a2 2 0 002 2h8a2 2 0 002-2v-2a1 1 0 00-1-1h-2v-2h2a1 1 0 001-1V9.87A4 4 0 0021 6V4a1 1 0 00-1-1h-1V2a1 1 0 00-1-1H6a1 1 0 00-1 1v1H4zm1 1h1v2a4.002 4.002 0 01-.83 2.44A2 2 0 015 6V4zm14 0v2a2 2 0 01-.17 2.44A4.002 4.002 0 0118 6V4h1z"/>
            </svg>
        );

        const StarIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
        );

        const ClockIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );

        const PauseIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="4" width="4" height="16"/>
                <rect x="14" y="4" width="4" height="16"/>
            </svg>
        );

        const PlayIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5,3 19,12 5,21"/>
            </svg>
        );

        const SpeakerIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"/>
            </svg>
        );

        const HomeIcon = ({ className = "w-6 h-6" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
        );

        // 100 Trivia Questions
        const QUESTIONS = [
            // Geography (10)
            { q: "What is the capital of Australia?", a: ["Sydney", "Melbourne", "Canberra", "Perth"], correct: 2, answer: "Canberra" },
            { q: "Which river is the longest in the world?", a: ["Amazon", "Nile", "Yangtze", "Mississippi"], correct: 1, answer: "Nile" },
            { q: "In which country would you find Machu Picchu?", a: ["Brazil", "Chile", "Peru", "Ecuador"], correct: 2, answer: "Peru" },
            { q: "What is the smallest country in the world?", a: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"], correct: 1, answer: "Vatican City" },
            { q: "Which desert is the largest in the world?", a: ["Gobi", "Sahara", "Antarctic", "Arabian"], correct: 2, answer: "Antarctic" },
            { q: "What is the capital of Canada?", a: ["Toronto", "Vancouver", "Montreal", "Ottawa"], correct: 3, answer: "Ottawa" },
            { q: "Which mountain is the tallest in the world?", a: ["K2", "Mount Everest", "Kangchenjunga", "Lhotse"], correct: 1, answer: "Mount Everest" },
            { q: "How many continents are there?", a: ["5", "6", "7", "8"], correct: 2, answer: "7" },
            { q: "Which country has the most islands?", a: ["Indonesia", "Philippines", "Sweden", "Finland"], correct: 2, answer: "Sweden" },
            { q: "What is the largest ocean on Earth?", a: ["Atlantic", "Indian", "Pacific", "Arctic"], correct: 2, answer: "Pacific" },
            
            // History (10)
            { q: "In what year did World War II end?", a: ["1943", "1944", "1945", "1946"], correct: 2, answer: "1945" },
            { q: "Who was the first President of the United States?", a: ["John Adams", "Thomas Jefferson", "Benjamin Franklin", "George Washington"], correct: 3, answer: "George Washington" },
            { q: "Which ancient wonder was located in Egypt?", a: ["Hanging Gardens", "Colossus", "Great Pyramid of Giza", "Lighthouse"], correct: 2, answer: "Great Pyramid of Giza" },
            { q: "The French Revolution began in which year?", a: ["1776", "1789", "1799", "1815"], correct: 1, answer: "1789" },
            { q: "Who painted the Mona Lisa?", a: ["Michelangelo", "Raphael", "Leonardo da Vinci", "Donatello"], correct: 2, answer: "Leonardo da Vinci" },
            { q: "Which empire was ruled by Genghis Khan?", a: ["Roman", "Ottoman", "Mongol", "Persian"], correct: 2, answer: "Mongol" },
            { q: "The Berlin Wall fell in which year?", a: ["1987", "1988", "1989", "1990"], correct: 2, answer: "1989" },
            { q: "Who discovered America in 1492?", a: ["Vasco da Gama", "Ferdinand Magellan", "Christopher Columbus", "Amerigo Vespucci"], correct: 2, answer: "Christopher Columbus" },
            { q: "Which war was fought between the North and South in America?", a: ["Revolutionary War", "Civil War", "World War I", "War of 1812"], correct: 1, answer: "Civil War" },
            { q: "The Renaissance began in which country?", a: ["France", "England", "Germany", "Italy"], correct: 3, answer: "Italy" },
            
            // Science (15)
            { q: "What is the chemical symbol for gold?", a: ["Go", "Gd", "Au", "Ag"], correct: 2, answer: "Au" },
            { q: "How many planets are in our solar system?", a: ["7", "8", "9", "10"], correct: 1, answer: "8" },
            { q: "What is the hardest natural substance on Earth?", a: ["Granite", "Diamond", "Titanium", "Quartz"], correct: 1, answer: "Diamond" },
            { q: "What is the speed of light in km/s (approximately)?", a: ["150,000", "200,000", "300,000", "400,000"], correct: 2, answer: "300,000" },
            { q: "Which element has the atomic number 1?", a: ["Helium", "Hydrogen", "Lithium", "Carbon"], correct: 1, answer: "Hydrogen" },
            { q: "What is the largest organ in the human body?", a: ["Liver", "Brain", "Skin", "Heart"], correct: 2, answer: "Skin" },
            { q: "How many bones are in the adult human body?", a: ["186", "206", "226", "246"], correct: 1, answer: "206" },
            { q: "What gas do plants absorb from the atmosphere?", a: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"], correct: 2, answer: "Carbon Dioxide" },
            { q: "What is the closest star to Earth?", a: ["Proxima Centauri", "Alpha Centauri", "The Sun", "Sirius"], correct: 2, answer: "The Sun" },
            { q: "What is the chemical formula for water?", a: ["HO2", "H2O", "H2O2", "OH"], correct: 1, answer: "H2O" },
            { q: "Which planet is known as the Red Planet?", a: ["Venus", "Jupiter", "Mars", "Saturn"], correct: 2, answer: "Mars" },
            { q: "What is the powerhouse of the cell?", a: ["Nucleus", "Ribosome", "Mitochondria", "Endoplasmic Reticulum"], correct: 2, answer: "Mitochondria" },
            { q: "What is absolute zero in Celsius?", a: ["-273.15", "-100", "0", "-459.67"], correct: 0, answer: "-273.15" },
            { q: "How many chromosomes do humans have?", a: ["23", "46", "44", "48"], correct: 1, answer: "46" },
            { q: "What is the most abundant gas in Earth's atmosphere?", a: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Argon"], correct: 2, answer: "Nitrogen" },
            
            // Entertainment (15)
            { q: "Which movie features the character Jack Dawson?", a: ["The Notebook", "Titanic", "Romeo + Juliet", "Inception"], correct: 1, answer: "Titanic" },
            { q: "Who played Iron Man in the Marvel Cinematic Universe?", a: ["Chris Evans", "Chris Hemsworth", "Robert Downey Jr.", "Mark Ruffalo"], correct: 2, answer: "Robert Downey Jr." },
            { q: "What is the name of Harry Potter's owl?", a: ["Errol", "Hedwig", "Pigwidgeon", "Scabbers"], correct: 1, answer: "Hedwig" },
            { q: "Which band performed 'Bohemian Rhapsody'?", a: ["The Beatles", "Led Zeppelin", "Queen", "Pink Floyd"], correct: 2, answer: "Queen" },
            { q: "What year was the first iPhone released?", a: ["2005", "2006", "2007", "2008"], correct: 2, answer: "2007" },
            { q: "Who directed the movie 'Jaws'?", a: ["George Lucas", "Steven Spielberg", "Francis Ford Coppola", "Martin Scorsese"], correct: 1, answer: "Steven Spielberg" },
            { q: "What is the highest-grossing film of all time?", a: ["Titanic", "Avengers: Endgame", "Avatar", "Star Wars: The Force Awakens"], correct: 2, answer: "Avatar" },
            { q: "Which TV show features a character named Walter White?", a: ["The Sopranos", "Breaking Bad", "The Wire", "Better Call Saul"], correct: 1, answer: "Breaking Bad" },
            { q: "Who is the voice of Woody in Toy Story?", a: ["Tim Allen", "Tom Hanks", "Billy Crystal", "John Ratzenberger"], correct: 1, answer: "Tom Hanks" },
            { q: "What is the name of Batman's butler?", a: ["Alfred", "Jarvis", "Geoffrey", "Sebastian"], correct: 0, answer: "Alfred" },
            { q: "Which artist released the album 'Thriller'?", a: ["Prince", "Michael Jackson", "Whitney Houston", "Madonna"], correct: 1, answer: "Michael Jackson" },
            { q: "What is the name of the coffee shop in 'Friends'?", a: ["Central Perk", "The Coffee House", "Moondance Diner", "Cafe Nervosa"], correct: 0, answer: "Central Perk" },
            { q: "Who created Mickey Mouse?", a: ["Jim Henson", "Walt Disney", "Chuck Jones", "Tex Avery"], correct: 1, answer: "Walt Disney" },
            { q: "What year did 'The Simpsons' first air?", a: ["1987", "1988", "1989", "1990"], correct: 2, answer: "1989" },
            { q: "Which superhero is known as the 'Man of Steel'?", a: ["Batman", "Superman", "Iron Man", "Captain America"], correct: 1, answer: "Superman" },
            
            // Sports (15)
            { q: "How many players are on a soccer team on the field?", a: ["9", "10", "11", "12"], correct: 2, answer: "11" },
            { q: "Which country has won the most FIFA World Cups?", a: ["Germany", "Argentina", "Brazil", "Italy"], correct: 2, answer: "Brazil" },
            { q: "In which sport would you perform a slam dunk?", a: ["Volleyball", "Tennis", "Basketball", "Handball"], correct: 2, answer: "Basketball" },
            { q: "How many rings are on the Olympic flag?", a: ["4", "5", "6", "7"], correct: 1, answer: "5" },
            { q: "Which tennis tournament is played on grass?", a: ["US Open", "French Open", "Wimbledon", "Australian Open"], correct: 2, answer: "Wimbledon" },
            { q: "Who holds the record for most goals in FIFA World Cup history?", a: ["Pel√©", "Ronaldo", "Miroslav Klose", "Gerd M√ºller"], correct: 2, answer: "Miroslav Klose" },
            { q: "What sport is played at Augusta National?", a: ["Tennis", "Golf", "Cricket", "Polo"], correct: 1, answer: "Golf" },
            { q: "How long is a marathon in miles?", a: ["24.2", "25.2", "26.2", "27.2"], correct: 2, answer: "26.2" },
            { q: "Which country invented cricket?", a: ["Australia", "India", "England", "South Africa"], correct: 2, answer: "England" },
            { q: "In American football, how many points is a touchdown worth?", a: ["3", "5", "6", "7"], correct: 2, answer: "6" },
            { q: "Who is known as 'The Greatest' in boxing?", a: ["Mike Tyson", "Floyd Mayweather", "Muhammad Ali", "Sugar Ray Leonard"], correct: 2, answer: "Muhammad Ali" },
            { q: "Which sport uses the terms 'love' and 'deuce'?", a: ["Badminton", "Tennis", "Squash", "Table Tennis"], correct: 1, answer: "Tennis" },
            { q: "How many players are on a baseball team on the field?", a: ["8", "9", "10", "11"], correct: 1, answer: "9" },
            { q: "What is the diameter of a basketball hoop in inches?", a: ["16", "17", "18", "19"], correct: 2, answer: "18" },
            { q: "Which NHL team has won the most Stanley Cups?", a: ["Toronto Maple Leafs", "Detroit Red Wings", "Montreal Canadiens", "Boston Bruins"], correct: 2, answer: "Montreal Canadiens" },
            
            // Literature (10)
            { q: "Who wrote 'Romeo and Juliet'?", a: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], correct: 1, answer: "William Shakespeare" },
            { q: "What is the first book of the Bible?", a: ["Exodus", "Genesis", "Leviticus", "Numbers"], correct: 1, answer: "Genesis" },
            { q: "Who wrote '1984'?", a: ["Aldous Huxley", "George Orwell", "Ray Bradbury", "H.G. Wells"], correct: 1, answer: "George Orwell" },
            { q: "What is the name of the hobbit in 'The Lord of the Rings'?", a: ["Bilbo", "Frodo", "Sam", "Pippin"], correct: 1, answer: "Frodo" },
            { q: "Who wrote 'Pride and Prejudice'?", a: ["Emily Bront√´", "Charlotte Bront√´", "Jane Austen", "Virginia Woolf"], correct: 2, answer: "Jane Austen" },
            { q: "What animal is Moby Dick?", a: ["Shark", "Whale", "Dolphin", "Octopus"], correct: 1, answer: "Whale" },
            { q: "Who wrote 'The Great Gatsby'?", a: ["Ernest Hemingway", "John Steinbeck", "F. Scott Fitzgerald", "William Faulkner"], correct: 2, answer: "F. Scott Fitzgerald" },
            { q: "What is the sequel to 'Alice in Wonderland'?", a: ["Return to Wonderland", "Through the Looking-Glass", "Alice's Adventures", "Wonderland Revisited"], correct: 1, answer: "Through the Looking-Glass" },
            { q: "Who wrote 'The Odyssey'?", a: ["Virgil", "Homer", "Sophocles", "Plato"], correct: 1, answer: "Homer" },
            { q: "What was Mark Twain's real name?", a: ["Samuel Clemens", "John Smith", "Thomas Hardy", "Charles Dodgson"], correct: 0, answer: "Samuel Clemens" },
            
            // General Knowledge (25)
            { q: "How many cards are in a standard deck?", a: ["48", "50", "52", "54"], correct: 2, answer: "52" },
            { q: "What is the largest mammal in the world?", a: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"], correct: 1, answer: "Blue Whale" },
            { q: "How many colors are in a rainbow?", a: ["5", "6", "7", "8"], correct: 2, answer: "7" },
            { q: "What is the main ingredient in guacamole?", a: ["Tomato", "Avocado", "Onion", "Lime"], correct: 1, answer: "Avocado" },
            { q: "What year was the United Nations founded?", a: ["1943", "1944", "1945", "1946"], correct: 2, answer: "1945" },
            { q: "What is the currency of Japan?", a: ["Yuan", "Won", "Yen", "Ringgit"], correct: 2, answer: "Yen" },
            { q: "How many teeth does an adult human have?", a: ["28", "30", "32", "34"], correct: 2, answer: "32" },
            { q: "What is the largest bird in the world?", a: ["Emu", "Ostrich", "Cassowary", "Albatross"], correct: 1, answer: "Ostrich" },
            { q: "What is the freezing point of water in Fahrenheit?", a: ["0", "32", "100", "212"], correct: 1, answer: "32" },
            { q: "How many sides does a hexagon have?", a: ["5", "6", "7", "8"], correct: 1, answer: "6" },
            { q: "What is the capital of Japan?", a: ["Osaka", "Kyoto", "Tokyo", "Yokohama"], correct: 2, answer: "Tokyo" },
            { q: "What year did the Titanic sink?", a: ["1910", "1911", "1912", "1913"], correct: 2, answer: "1912" },
            { q: "How many stripes are on the American flag?", a: ["11", "12", "13", "14"], correct: 2, answer: "13" },
            { q: "What is the smallest prime number?", a: ["0", "1", "2", "3"], correct: 2, answer: "2" },
            { q: "What language has the most native speakers?", a: ["English", "Spanish", "Mandarin Chinese", "Hindi"], correct: 2, answer: "Mandarin Chinese" },
            { q: "What is the boiling point of water in Celsius?", a: ["90", "100", "110", "212"], correct: 1, answer: "100" },
            { q: "How many weeks are in a year?", a: ["48", "50", "52", "54"], correct: 2, answer: "52" },
            { q: "What is the national animal of Australia?", a: ["Koala", "Kangaroo", "Platypus", "Wombat"], correct: 1, answer: "Kangaroo" },
            { q: "What is the square root of 144?", a: ["10", "11", "12", "13"], correct: 2, answer: "12" },
            { q: "How many Great Lakes are there?", a: ["4", "5", "6", "7"], correct: 1, answer: "5" },
            { q: "What is the longest bone in the human body?", a: ["Tibia", "Femur", "Humerus", "Fibula"], correct: 1, answer: "Femur" },
            { q: "What company makes the iPhone?", a: ["Samsung", "Google", "Apple", "Microsoft"], correct: 2, answer: "Apple" },
            { q: "How many minutes are in a day?", a: ["1240", "1340", "1440", "1540"], correct: 2, answer: "1440" },
            { q: "What is the capital of Germany?", a: ["Munich", "Frankfurt", "Berlin", "Hamburg"], correct: 2, answer: "Berlin" },
            { q: "What is the hardest rock?", a: ["Granite", "Marble", "Diamond", "Obsidian"], correct: 2, answer: "Diamond" }
        ];

        // Randomize the correct answer positions
        const randomizeAnswers = (questions) => {
            return questions.map(q => {
                const correctAnswer = q.a[q.correct];
                const shuffledAnswers = shuffle([...q.a]);
                const newCorrectIndex = shuffledAnswers.indexOf(correctAnswer);
                return {
                    ...q,
                    a: shuffledAnswers,
                    correct: newCorrectIndex,
                    answer: correctAnswer
                };
            });
        };

        const TriviaHero = () => {
            // Game states: 'home', 'playing', 'paused', 'results', 'leaderboard'
            const [gameState, setGameState] = useState('home');
            const [gameMode, setGameMode] = useState('classic'); // 'classic' or 'expert'
            const [questions, setQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [timer, setTimer] = useState(60);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [isCorrect, setIsCorrect] = useState(null);
            const [correctAnswers, setCorrectAnswers] = useState(0);
            const [leaderboard, setLeaderboard] = useState([]);
            const [playerName, setPlayerName] = useState('');
            const [expertInput, setExpertInput] = useState('');
            const [showNameInput, setShowNameInput] = useState(false);
            const [scoreSaved, setScoreSaved] = useState(false);
            
            const timerRef = useRef(null);
            const speechRef = useRef(null);

            // Load leaderboard from localStorage
            useEffect(() => {
                const saved = localStorage.getItem('triviaHeroLeaderboard');
                if (saved) {
                    setLeaderboard(JSON.parse(saved));
                }
            }, []);

            // Timer effect
            useEffect(() => {
                if (gameState === 'playing' && timer > 0 && selectedAnswer === null) {
                    timerRef.current = setTimeout(() => {
                        setTimer(t => t - 1);
                    }, 1000);
                } else if (timer === 0 && selectedAnswer === null) {
                    handleTimeout();
                }
                return () => clearTimeout(timerRef.current);
            }, [gameState, timer, selectedAnswer]);

            // Text-to-speech function
            const speak = useCallback((text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.1;
                    
                    // Try to find a female voice
                    const voices = window.speechSynthesis.getVoices();
                    const femaleVoices = voices.filter(v => 
                        v.name.includes('Samantha') || 
                        v.name.includes('Victoria') || 
                        v.name.includes('Karen') ||
                        v.name.includes('Female') ||
                        v.name.includes('Zira') ||
                        v.name.includes('Google') && v.name.includes('Female')
                    );
                    
                    if (femaleVoices.length > 0) {
                        utterance.voice = femaleVoices[0];
                    } else if (voices.length > 0) {
                        // Fallback to any available voice
                        const englishVoice = voices.find(v => v.lang.startsWith('en'));
                        if (englishVoice) utterance.voice = englishVoice;
                    }
                    
                    speechRef.current = utterance;
                    window.speechSynthesis.speak(utterance);
                }
            }, []);

            // Stop speech
            const stopSpeech = () => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                }
            };

            // Read current question
            useEffect(() => {
                if (gameState === 'playing' && questions[currentQuestionIndex] && selectedAnswer === null) {
                    // Small delay to ensure voices are loaded
                    setTimeout(() => {
                        speak(questions[currentQuestionIndex].q);
                    }, 100);
                }
            }, [gameState, currentQuestionIndex, questions, speak, selectedAnswer]);

            // Load voices
            useEffect(() => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.onvoiceschanged = () => {
                        window.speechSynthesis.getVoices();
                    };
                }
            }, []);

            const startGame = () => {
                const shuffledQuestions = randomizeAnswers(shuffle([...QUESTIONS]));
                setQuestions(shuffledQuestions);
                setCurrentQuestionIndex(0);
                setScore(0);
                setStreak(0);
                setTimer(gameMode === 'expert' ? 90 : 60);
                setSelectedAnswer(null);
                setIsCorrect(null);
                setCorrectAnswers(0);
                setExpertInput('');
                setShowNameInput(false);
                setScoreSaved(false);
                setGameState('playing');
            };

            const handleTimeout = () => {
                setSelectedAnswer(-1);
                setIsCorrect(false);
                setStreak(0);
                
                setTimeout(() => {
                    nextQuestion();
                }, gameMode === 'expert' ? 2500 : 1500);
            };

            const handleAnswer = (answerIndex) => {
                if (selectedAnswer !== null) return;
                
                stopSpeech();
                const question = questions[currentQuestionIndex];
                const correct = answerIndex === question.correct;
                
                setSelectedAnswer(answerIndex);
                setIsCorrect(correct);
                
                if (correct) {
                    const basePoints = gameMode === 'expert' ? 150 : 100;
                    const streakBonus = streak * 50;
                    setScore(s => s + basePoints + streakBonus);
                    setStreak(s => s + 1);
                    setCorrectAnswers(c => c + 1);
                } else {
                    setStreak(0);
                }
                
                setTimeout(() => {
                    nextQuestion();
                }, gameMode === 'expert' ? 2500 : 1500);
            };

            const handleExpertSubmit = () => {
                if (selectedAnswer !== null || !expertInput.trim()) return;
                
                stopSpeech();
                const question = questions[currentQuestionIndex];
                const sim = similarity(expertInput.trim(), question.answer);
                const correct = sim >= 0.8;
                
                setSelectedAnswer(correct ? question.correct : -1);
                setIsCorrect(correct);
                
                if (correct) {
                    const basePoints = 150;
                    const streakBonus = streak * 50;
                    setScore(s => s + basePoints + streakBonus);
                    setStreak(s => s + 1);
                    setCorrectAnswers(c => c + 1);
                } else {
                    setStreak(0);
                }
                
                setTimeout(() => {
                    nextQuestion();
                }, 2500);
            };

            const nextQuestion = () => {
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(i => i + 1);
                    setSelectedAnswer(null);
                    setIsCorrect(null);
                    setTimer(gameMode === 'expert' ? 90 : 60);
                    setExpertInput('');
                } else {
                    setGameState('results');
                }
            };

            const pauseGame = () => {
                stopSpeech();
                setGameState('paused');
            };

            const resumeGame = () => {
                setGameState('playing');
            };

            const quitGame = () => {
                stopSpeech();
                setGameState('results');
            };

            const isTopScore = () => {
                if (leaderboard.length < 10) return true;
                return score > leaderboard[leaderboard.length - 1].score;
            };

            const saveScore = () => {
                if (!playerName.trim() || scoreSaved) return;
                
                const newEntry = {
                    name: playerName.trim(),
                    score,
                    date: new Date().toLocaleDateString(),
                    mode: gameMode
                };
                
                const newLeaderboard = [...leaderboard, newEntry]
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 10);
                
                setLeaderboard(newLeaderboard);
                localStorage.setItem('triviaHeroLeaderboard', JSON.stringify(newLeaderboard));
                setScoreSaved(true);
                setShowNameInput(false);
            };

            const getTimerColor = () => {
                if (timer > 30) return 'text-green-400';
                if (timer > 10) return 'text-yellow-400';
                return 'text-red-400 pulse-animation';
            };

            const repeatQuestion = () => {
                if (questions[currentQuestionIndex]) {
                    speak(questions[currentQuestionIndex].q);
                }
            };

            // Home Screen
            if (gameState === 'home') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-4">
                        <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl slide-in">
                            <div className="text-center mb-8">
                                <div className="flex items-center justify-center gap-3 mb-4">
                                    <TrophyIcon className="w-12 h-12 text-yellow-400" />
                                    <h1 className="text-4xl font-bold text-white">Trivia Hero</h1>
                                </div>
                                <p className="text-blue-200">Test your knowledge!</p>
                            </div>
                            
                            <div className="space-y-4 mb-8">
                                <button
                                    onClick={() => setGameMode('classic')}
                                    className={`w-full p-4 rounded-xl transition-all duration-300 ${
                                        gameMode === 'classic'
                                            ? 'bg-purple-500 ring-4 ring-purple-300 scale-105'
                                            : 'bg-white/20 hover:bg-white/30'
                                    }`}
                                >
                                    <div className="flex items-center gap-4">
                                        <span className="text-3xl">üéØ</span>
                                        <div className="text-left">
                                            <h3 className="text-white font-bold text-lg">Classic Mode</h3>
                                            <p className="text-blue-200 text-sm">Multiple choice ‚Ä¢ 60 seconds ‚Ä¢ 100 pts</p>
                                        </div>
                                    </div>
                                </button>
                                
                                <button
                                    onClick={() => setGameMode('expert')}
                                    className={`w-full p-4 rounded-xl transition-all duration-300 ${
                                        gameMode === 'expert'
                                            ? 'bg-purple-500 ring-4 ring-purple-300 scale-105'
                                            : 'bg-white/20 hover:bg-white/30'
                                    }`}
                                >
                                    <div className="flex items-center gap-4">
                                        <span className="text-3xl">‚úçÔ∏è</span>
                                        <div className="text-left">
                                            <h3 className="text-white font-bold text-lg">Expert Mode</h3>
                                            <p className="text-blue-200 text-sm">Type your answer ‚Ä¢ 90 seconds ‚Ä¢ 150 pts</p>
                                        </div>
                                    </div>
                                </button>
                            </div>
                            
                            <button
                                onClick={startGame}
                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold py-4 px-8 rounded-xl text-lg hover:from-green-500 hover:to-emerald-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 mb-4"
                            >
                                Start Game
                            </button>
                            
                            {leaderboard.length > 0 && (
                                <button
                                    onClick={() => setGameState('leaderboard')}
                                    className="w-full bg-white/20 text-white font-semibold py-3 px-8 rounded-xl hover:bg-white/30 transition-all duration-300 flex items-center justify-center gap-2"
                                >
                                    <TrophyIcon className="w-5 h-5 text-yellow-400" />
                                    View Leaderboard
                                </button>
                            )}
                        </div>
                    </div>
                );
            }

            // Paused Screen
            if (gameState === 'paused') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-4">
                        <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl slide-in">
                            <h2 className="text-3xl font-bold text-white text-center mb-8">Game Paused</h2>
                            
                            <div className="space-y-4">
                                <button
                                    onClick={resumeGame}
                                    className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold py-4 px-8 rounded-xl text-lg hover:from-green-500 hover:to-emerald-600 transition-all duration-300 flex items-center justify-center gap-2"
                                >
                                    <PlayIcon className="w-6 h-6" />
                                    Resume
                                </button>
                                
                                <button
                                    onClick={quitGame}
                                    className="w-full bg-white/20 text-white font-semibold py-4 px-8 rounded-xl hover:bg-white/30 transition-all duration-300"
                                >
                                    Quit Game
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Game Screen
            if (gameState === 'playing') {
                const question = questions[currentQuestionIndex];
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 p-4">
                        <div className="max-w-2xl mx-auto">
                            {/* Header */}
                            <div className="flex items-center justify-between mb-6">
                                <div className={`flex items-center gap-2 ${getTimerColor()}`}>
                                    <ClockIcon className="w-6 h-6" />
                                    <span className="text-2xl font-bold">{timer}s</span>
                                </div>
                                
                                <button
                                    onClick={pauseGame}
                                    className="bg-white/20 p-2 rounded-lg hover:bg-white/30 transition-colors"
                                >
                                    <PauseIcon className="w-6 h-6 text-white" />
                                </button>
                                
                                <div className="text-right">
                                    <div className="flex items-center gap-2 text-yellow-400">
                                        <StarIcon className="w-5 h-5" />
                                        <span className="text-xl font-bold">{score}</span>
                                    </div>
                                    {streak > 0 && (
                                        <div className="text-orange-400 text-sm font-semibold">
                                            üî• Streak: {streak}x
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* Question Card */}
                            <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-6 shadow-2xl slide-in">
                                <div className="flex items-center justify-between mb-4">
                                    <span className="text-blue-200 font-semibold">
                                        Question {currentQuestionIndex + 1} of {questions.length}
                                    </span>
                                    <span className="text-blue-200 text-sm">
                                        {gameMode === 'expert' ? '‚úçÔ∏è Expert' : 'üéØ Classic'}
                                    </span>
                                </div>
                                
                                <div className="flex items-start gap-3 mb-6">
                                    <h2 className="text-xl md:text-2xl font-bold text-white flex-1">
                                        {question?.q}
                                    </h2>
                                    <button
                                        onClick={repeatQuestion}
                                        className="bg-white/20 p-2 rounded-lg hover:bg-white/30 transition-colors flex-shrink-0"
                                        title="Read question aloud"
                                    >
                                        <SpeakerIcon className="w-5 h-5 text-white" />
                                    </button>
                                </div>
                                
                                {gameMode === 'classic' ? (
                                    <div className="grid gap-3">
                                        {question?.a.map((answer, index) => {
                                            let buttonClass = 'bg-white/20 hover:bg-white/30 text-white';
                                            
                                            if (selectedAnswer !== null) {
                                                if (index === question.correct) {
                                                    buttonClass = 'bg-green-500 text-white';
                                                } else if (index === selectedAnswer && !isCorrect) {
                                                    buttonClass = 'bg-red-500 text-white shake';
                                                } else {
                                                    buttonClass = 'bg-white/10 text-white/50';
                                                }
                                            }
                                            
                                            return (
                                                <button
                                                    key={index}
                                                    onClick={() => handleAnswer(index)}
                                                    disabled={selectedAnswer !== null}
                                                    className={`w-full p-4 rounded-xl font-semibold text-left transition-all duration-300 ${buttonClass}`}
                                                >
                                                    <span className="mr-3 text-blue-300">{String.fromCharCode(65 + index)}.</span>
                                                    {answer}
                                                </button>
                                            );
                                        })}
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <input
                                            type="text"
                                            value={expertInput}
                                            onChange={(e) => setExpertInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleExpertSubmit()}
                                            placeholder="Type your answer..."
                                            disabled={selectedAnswer !== null}
                                            className={`w-full p-4 rounded-xl text-lg font-semibold outline-none transition-all duration-300 ${
                                                selectedAnswer !== null
                                                    ? isCorrect
                                                        ? 'bg-green-500 text-white'
                                                        : 'bg-red-500 text-white'
                                                    : 'bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-white/50'
                                            }`}
                                        />
                                        
                                        {selectedAnswer !== null && !isCorrect && (
                                            <div className="text-yellow-400 text-center font-semibold">
                                                Correct answer: {question.answer}
                                            </div>
                                        )}
                                        
                                        <button
                                            onClick={handleExpertSubmit}
                                            disabled={selectedAnswer !== null || !expertInput.trim()}
                                            className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold py-4 px-8 rounded-xl text-lg hover:from-green-500 hover:to-emerald-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Submit Answer
                                        </button>
                                    </div>
                                )}
                                
                                {selectedAnswer !== null && gameMode === 'classic' && !isCorrect && (
                                    <div className="mt-4 text-yellow-400 text-center font-semibold">
                                        Correct answer: {question.a[question.correct]}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Results Screen
            if (gameState === 'results') {
                const accuracy = questions.length > 0 
                    ? Math.round((correctAnswers / Math.min(currentQuestionIndex + 1, questions.length)) * 100) 
                    : 0;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-4">
                        <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl slide-in">
                            <div className="text-center mb-8">
                                <TrophyIcon className="w-16 h-16 text-yellow-400 mx-auto mb-4" />
                                <h2 className="text-3xl font-bold text-white mb-2">Game Over!</h2>
                                <p className="text-6xl font-bold text-yellow-400">{score}</p>
                                <p className="text-blue-200">points</p>
                            </div>
                            
                            <div className="bg-white/10 rounded-xl p-4 mb-6 space-y-2">
                                <div className="flex justify-between text-white">
                                    <span>Questions Answered:</span>
                                    <span className="font-bold">{Math.min(currentQuestionIndex + 1, questions.length)}</span>
                                </div>
                                <div className="flex justify-between text-white">
                                    <span>Correct Answers:</span>
                                    <span className="font-bold text-green-400">{correctAnswers}</span>
                                </div>
                                <div className="flex justify-between text-white">
                                    <span>Accuracy:</span>
                                    <span className="font-bold">{accuracy}%</span>
                                </div>
                                <div className="flex justify-between text-white">
                                    <span>Mode:</span>
                                    <span className="font-bold">{gameMode === 'expert' ? '‚úçÔ∏è Expert' : 'üéØ Classic'}</span>
                                </div>
                            </div>
                            
                            {isTopScore() && !scoreSaved && (
                                <div className="mb-6">
                                    {!showNameInput ? (
                                        <button
                                            onClick={() => setShowNameInput(true)}
                                            className="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold py-3 px-8 rounded-xl hover:from-yellow-500 hover:to-orange-600 transition-all duration-300"
                                        >
                                            üèÜ Save Your Score!
                                        </button>
                                    ) : (
                                        <div className="space-y-3">
                                            <input
                                                type="text"
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                placeholder="Enter your name..."
                                                maxLength={20}
                                                className="w-full p-3 rounded-xl bg-white/20 text-white placeholder-white/50 outline-none focus:ring-2 focus:ring-white/50"
                                            />
                                            <button
                                                onClick={saveScore}
                                                disabled={!playerName.trim()}
                                                className="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold py-3 px-8 rounded-xl hover:from-yellow-500 hover:to-orange-600 transition-all duration-300 disabled:opacity-50"
                                            >
                                                Save Score
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {scoreSaved && (
                                <div className="mb-6 text-center text-green-400 font-semibold">
                                    ‚úì Score saved to leaderboard!
                                </div>
                            )}
                            
                            <div className="space-y-3">
                                <button
                                    onClick={startGame}
                                    className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold py-4 px-8 rounded-xl text-lg hover:from-green-500 hover:to-emerald-600 transition-all duration-300"
                                >
                                    Play Again
                                </button>
                                
                                <button
                                    onClick={() => setGameState('home')}
                                    className="w-full bg-white/20 text-white font-semibold py-3 px-8 rounded-xl hover:bg-white/30 transition-all duration-300 flex items-center justify-center gap-2"
                                >
                                    <HomeIcon className="w-5 h-5" />
                                    Back to Home
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Leaderboard Screen
            if (gameState === 'leaderboard') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-4">
                        <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl slide-in">
                            <div className="text-center mb-6">
                                <TrophyIcon className="w-12 h-12 text-yellow-400 mx-auto mb-2" />
                                <h2 className="text-3xl font-bold text-white">Leaderboard</h2>
                            </div>
                            
                            <div className="space-y-2 mb-6">
                                {leaderboard.map((entry, index) => {
                                    let rankStyle = 'bg-white/10';
                                    let rankIcon = `${index + 1}`;
                                    
                                    if (index === 0) {
                                        rankStyle = 'bg-gradient-to-r from-yellow-500/30 to-yellow-600/30 ring-2 ring-yellow-400';
                                        rankIcon = 'ü•á';
                                    } else if (index === 1) {
                                        rankStyle = 'bg-gradient-to-r from-gray-400/30 to-gray-500/30 ring-2 ring-gray-400';
                                        rankIcon = 'ü•à';
                                    } else if (index === 2) {
                                        rankStyle = 'bg-gradient-to-r from-orange-600/30 to-orange-700/30 ring-2 ring-orange-500';
                                        rankIcon = 'ü•â';
                                    }
                                    
                                    return (
                                        <div
                                            key={index}
                                            className={`${rankStyle} rounded-xl p-3 flex items-center gap-3`}
                                        >
                                            <span className="text-xl w-8 text-center">{rankIcon}</span>
                                            <div className="flex-1">
                                                <div className="text-white font-semibold">{entry.name}</div>
                                                <div className="text-blue-200 text-xs">{entry.date}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-yellow-400 font-bold">{entry.score}</div>
                                                <div className="text-xs">{entry.mode === 'expert' ? '‚úçÔ∏è' : 'üéØ'}</div>
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {leaderboard.length === 0 && (
                                    <div className="text-center text-blue-200 py-8">
                                        No scores yet. Be the first!
                                    </div>
                                )}
                            </div>
                            
                            <button
                                onClick={() => setGameState('home')}
                                className="w-full bg-white/20 text-white font-semibold py-3 px-8 rounded-xl hover:bg-white/30 transition-all duration-300 flex items-center justify-center gap-2"
                            >
                                <HomeIcon className="w-5 h-5" />
                                Back to Home
                            </button>
                        </div>
                    </div>
                );
            }

            return null;
        };

        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TriviaHero />);
    </script>
</body>
</html>
