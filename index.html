<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trivia Hero</title>

  <!-- React 18 + ReactDOM + Babel (for JSX in-browser) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body, #root { height: 100%; margin: 0; }
    .no-select { user-select: none; -webkit-user-select: none; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 text-white antialiased no-select">
  <div id="root" class="h-full"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /***********************
     * ICONS (trimmed for brevity)
     ***********************/
    const TrophyIcon = ({ className="w-8 h-8" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M6 2a1 1..." /></svg>
    );
    const StarIcon = ({ className="w-6 h-6" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M12 .587l..." /></svg>
    );
    const ClockIcon = ({ className="w-5 h-5" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M12 1.75..." /></svg>
    );
    const PauseIcon = ({ className="w-5 h-5" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M6 4a2..." /></svg>
    );
    const SpeakerIcon = ({ className="w-5 h-5" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6..." /></svg>
    );

    /********************
     * HELPERS
     ********************/
    function shuffle(arr){...}   // same as before
    function levenshtein(a,b){...}
    function similarity(a,b){...}
    function getFemaleVoice(){...}
    function speak(text, voiceRef){...}
    function stopSpeech(){ if(window.speechSynthesis) window.speechSynthesis.cancel(); }

    async function loadQuestions() {
      const cats=["geography","history","science","entertainment","sports","literature","general"];
      let all=[]; 
      for (let c of cats){ 
        const r=await fetch(`questions/${c}.json`);
        all=[...all, ...await r.json()];
      }
      return all;
    }
    function prepareQuestions(raw){...} // same as before

    /********************
     * LEADERBOARD
     ********************/
    const LB_KEY="trivia_lb";
    function loadLeaderboard(){...}
    function saveLeaderboard(l){ localStorage.setItem(LB_KEY, JSON.stringify(l)); }
    function addScoreToLeaderboard(name,score,mode){...}

    /********************
     * APP
     ********************/
    const MODES={
      CLASSIC:{key:"CLASSIC",label:"Classic üéØ",basePoints:100,duration:60,expert:false},
      EXPERT:{key:"EXPERT",label:"Expert ‚úçÔ∏è",basePoints:150,duration:90,expert:true}
    };

    function useVoices(){...}

    function TriviaHero(){
      const [screen,setScreen]=useState("HOME");
      const [mode,setMode]=useState(MODES.CLASSIC);
      const [questions,setQuestions]=useState([]);
      const [qIndex,setQIndex]=useState(0);
      const [timeLeft,setTimeLeft]=useState(mode.duration);
      const [score,setScore]=useState(0);
      const [streak,setStreak]=useState(0);
      const [correctCount,setCorrectCount]=useState(0);
      const [answered,setAnswered]=useState(0);
      const [selected,setSelected]=useState(null);
      const [feedback,setFeedback]=useState(null);
      const [paused,setPaused]=useState(false);
      const [playerName,setPlayerName]=useState("");
      const [leaderboard,setLeaderboard]=useState(loadLeaderboard());
      const [canSave,setCanSave]=useState(false);
      const [allQuestions,setAllQuestions]=useState([]);

      useEffect(()=>{ loadQuestions().then(setAllQuestions); },[]);
      const voiceRef=useVoices();
      const timerRef=useRef(null), advanceRef=useRef(null);
      const currentQuestion=questions[qIndex];

      const startGame=async()=>{
        stopSpeech();
        const raw=allQuestions.length?allQuestions:await loadQuestions();
        const prepped=prepareQuestions(raw);
        setQuestions(shuffle(prepped));
        setQIndex(0); setTimeLeft(mode.duration); setScore(0);
        setStreak(0); setCorrectCount(0); setAnswered(0);
        setSelected(null); setFeedback(null);
        setPaused(false); setCanSave(false); setScreen("GAME");
      };

      useEffect(()=>{
        if(screen!=="GAME"||paused) return;
        if(timeLeft<=0){ endGame(); return; }
        timerRef.current=setInterval(()=>setTimeLeft(t=>t-1),1000);
        return ()=>clearInterval(timerRef.current);
      },[screen,paused,timeLeft]);

      useEffect(()=>{
        if(screen==="GAME"&&currentQuestion&&!paused) speak(currentQuestion.q,voiceRef);
      },[screen,qIndex,paused,currentQuestion]);

      const endGame=()=>{...};
      const pauseGame=()=>{setPaused(true);stopSpeech();};
      const resumeGame=()=>setPaused(false);
      const quitToHome=()=>{ stopSpeech(); setScreen("HOME"); };

      const handleAnswer=(i)=>{...};
      const [typed,setTyped]=useState("");
      const submitTypedAnswer=()=>{...};
      const nextQuestion=()=>{...};
      const saveScore=()=>{...};
      const accuracy=answered?Math.round((correctCount/answered)*100):0;

      /* ---- Screens ---- */
      const HomeScreen=()=>(
        <div className="flex items-center justify-center h-full p-4">
          <div className="w-full max-w-3xl bg-white/10 rounded-2xl p-6">
            <h1 className="text-4xl font-bold text-center mb-6">Trivia Hero</h1>
            <div className="grid sm:grid-cols-2 gap-4 mb-6">
              <button onClick={()=>setMode(MODES.CLASSIC)} className="p-4 bg-white/10 rounded-xl">Classic üéØ</button>
              <button onClick={()=>setMode(MODES.EXPERT)} className="p-4 bg-white/10 rounded-xl">Expert ‚úçÔ∏è</button>
            </div>
            <div className="flex justify-center gap-3">
              <button onClick={startGame} className="px-6 py-3 bg-white text-indigo-700 rounded-xl">Start</button>
              {leaderboard.length>0 && (
                <button onClick={()=>setScreen("LEADERBOARD")} className="px-6 py-3 bg-white/10 rounded-xl">Leaderboard</button>
              )}
            </div>
          </div>
        </div>
      );

      const GameScreen=()=>(
        <div className="flex items-center justify-center h-full p-4">
          <div className="w-full max-w-3xl bg-white/10 rounded-2xl p-4">
            <div className="mb-2 flex justify-between">
              <span>Q{qIndex+1}/{questions.length}</span>
              <span>{timeLeft}s</span>
            </div>
            <h2 className="text-xl mb-4">{currentQuestion?.q}</h2>
            {!mode.expert ? (
              <div className="grid sm:grid-cols-2 gap-2">
                {currentQuestion?.a.map((opt,i)=>(
                  <button key={i} onClick={()=>handleAnswer(i)}
                    disabled={selected!==null}
                    className="p-3 rounded-xl bg-white/10">{opt}</button>
                ))}
              </div>
            ):(
              <div className="flex gap-2">
                <input value={typed} onChange={e=>setTyped(e.target.value)} className="flex-1 p-2 text-black rounded"/>
                <button onClick={submitTypedAnswer} className="px-4 py-2 bg-white text-indigo-700 rounded">Submit</button>
              </div>
            )}
          </div>
        </div>
      );

      const ResultsScreen=()=>(
        <div className="flex items-center justify-center h-full p-4">
          <div className="bg-white/10 p-6 rounded-2xl max-w-xl w-full text-center">
            <h2 className="text-3xl font-bold mb-4">Results</h2>
            <p className="text-4xl font-black">{score}</p>
            <p className="mb-4">{accuracy}% Accuracy</p>
            {canSave && (
              <div className="flex gap-2 mb-4">
                <input value={playerName} onChange={e=>setPlayerName(e.target.value)} placeholder="Name" className="flex-1 p-2 text-black rounded"/>
                <button onClick={saveScore} className="px-4 py-2 bg-white text-indigo-700 rounded">Save</button>
              </div>
            )}
            <div className="flex gap-2 justify-center">
              <button onClick={startGame} className="px-4 py-2 bg-white text-indigo-700 rounded">Play Again</button>
              <button onClick={()=>setScreen("HOME")} className="px-4 py-2 bg-white/10 rounded">Home</button>
            </div>
          </div>
        </div>
      );

      const LeaderboardScreen=()=>(
        <div className="flex items-center justify-center h-full p-4">
          <div className="bg-white/10 p-6 rounded-2xl max-w-2xl w-full">
            <h2 className="text-3xl font-bold text-center mb-4">Leaderboard</h2>
            <table className="w-full">
              <thead><tr><th>Name</th><th>Score</th><th>Mode</th><th>Date</th></tr></thead>
              <tbody>
                {leaderboard.map((e,i)=>(
                  <tr key={i} className="border-t border-white/20">
                    <td>{e.name}</td><td>{e.score}</td><td>{e.mode}</td><td>{new Date(e.date).toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
            <div className="text-center mt-4">
              <button onClick={()=>setScreen("HOME")} className="px-4 py-2 bg-white/10 rounded">Home</button>
            </div>
          </div>
        </div>
      );

      return (
        <div className="h-full">
          {screen==="HOME" && <HomeScreen/>}
          {screen==="GAME" && <GameScreen/>}
          {screen==="RESULTS" && <ResultsScreen/>}
          {screen==="LEADERBOARD" && <LeaderboardScreen/>}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<TriviaHero />);
  </script>
</body>
</html>
